<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hi·ªáu ·ª©ng r∆°i hoa anh ƒë√†o (Sakura) ‚Äî Demo</title>
  <style>
    /* Reset */
    html,body{height:100%;margin:0}
    body{font-family:system-ui,Segoe UI,Roboto,'Noto Sans',sans-serif;background:#fff}

    /* Container gi·ªØ hi·ªáu ·ª©ng - ƒë·∫∑t position fixed ƒë·ªÉ ph·ªß to√†n trang */
    .sakura-wrap{
      position:fixed;inset:0;pointer-events:none;z-index:9999;overflow:hidden;
    }

    /* M·ªói c√°nh hoa */
    .sakura{
      position:absolute;top:-10vh;left:0;will-change:transform,opacity;
      width:28px;height:28px;opacity:0.95;transform-origin:center;
    }

    /* M·ªôt SVG c√°nh hoa nh·ªè d√πng l√†m h√¨nh (inline SVG s·∫Ω ƒë∆∞·ª£c ch√®n v√†o m·ªói element) */
    .sakura svg{width:100%;height:100%;display:block}

    /* T√πy animation s·∫Ω ƒë∆∞·ª£c g√°n ƒë·ªông b·∫±ng JS (t·ªëc ƒë·ªô, ƒë·ªô l·ªách, xoay) */

    /* T√πy ch·ªçn n√∫t b·∫≠t/t·∫Øt (ch·ªâ v√≠ d·ª• - pointer-events b·∫≠t cho v√πng n√†y) */
    .sakura-control{position:fixed;right:12px;bottom:12px;z-index:10000;pointer-events:auto}
    .sakura-control button{background:#fff;border:1px solid #eee;padding:8px 10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.08);cursor:pointer}

    /* Gi·∫£m hi·ªáu ·ª©ng tr√™n c√°c m√†n nh·ªè ho·∫∑c khi hi·ªáu nƒÉng k√©m */
    @media (max-width:640px){
      .sakura{width:20px;height:20px}
    }
  </style>
</head>
<body>

  <div id="sakuraWrap" class="sakura-wrap" aria-hidden="true"></div>

  <!-- Control demo (t·∫Øt/b·∫≠t) -->
  <div class="sakura-control">
    <button id="toggleBtn">T·∫Øt hoa anh ƒë√†o</button>
  </div>

  <main style="padding:40px;max-width:800px;margin:0 auto;">
    <h1>Trang demo: Hi·ªáu ·ª©ng r∆°i hoa anh ƒë√†o üå∏</h1>
    <p>Hi·ªáu ·ª©ng n√†y ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript: s·∫Ω th√™m ph·∫ßn t·ª≠ <code>.sakura</code> v√†o trang v√† g√°n animation ƒë·ªông cho t·ª´ng c√°nh hoa. B·∫°n c√≥ th·ªÉ nh√∫ng tr·ª±c ti·∫øp m√£ n√†y v√†o website (v√≠ d·ª•: ·ªü cu·ªëi &lt;body&gt;).</p>
  </main>

  <script>
  /* ---------- C·∫•u h√¨nh (d·ªÖ ch·ªânh) ---------- */
  const CONFIG = {
    petalCount: 30,           // S·ªë l∆∞·ª£ng m·∫∑c ƒë·ªãnh tr√™n m√†n h√¨nh
    spawnInterval: 600,       // (ms) th·ªùi gian t·∫°o m·ªôt c√°nh m·ªõi (m·ª©c th·∫•p -> nhi·ªÅu h∆°n)
    minSize: 18,              // px
    maxSize: 42,              // px
    fallDurationMin: 6000,    // ms
    fallDurationMax: 12000,   // ms
    swayRange: 120,           // px bi√™n ƒë·ªô ngang khi r∆°i
    rotationMin: -30,         // ƒë·ªô
    rotationMax: 360,         // ƒë·ªô
    useImage: false,          // N·∫øu mu·ªën d√πng image URL: true
    imageURL: ''              // URL ·∫£nh c√°nh hoa (PNG/SVG) n·∫øu useImage=true
  };

  /* ---------- SVG c√°nh hoa (d·ª± ph√≤ng, nh·∫π, kh√¥ng c·∫ßn t·∫£i th√™m file) ---------- */
  const PETAL_SVG = `
  <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0" stop-color="#FFE9F0"/>
        <stop offset="1" stop-color="#FFCFE0"/>
      </linearGradient>
    </defs>
    <path d="M32 4c6 0 12 6 12 12 0 6-10 14-12 16-2-2-12-10-12-16C20 10 26 4 32 4z"
          fill="url(#g)" stroke="#FFB3CF" stroke-width="1"/>
  </svg>`;

  /* ---------- Helper random ---------- */
  function rand(min, max){ return Math.random() * (max - min) + min }
  function randInt(min, max){ return Math.floor(rand(min, max+1)) }

  const wrap = document.getElementById('sakuraWrap');
  let running = true;
  let intervalId = null;

  function createPetal(){
    const el = document.createElement('div');
    el.className = 'sakura';

    const size = Math.round(rand(CONFIG.minSize, CONFIG.maxSize));
    el.style.width = size + 'px';
    el.style.height = size + 'px';

    // v·ªã tr√≠ xu·∫•t hi·ªán ngang (c√≥ th·ªÉ xu·∫•t t·ª´ ngo√†i l·ªÅ) - ƒë·∫∑t ph·∫ßn trƒÉm
    const startX = rand(-10, 110); // % c·ªßa viewport width
    el.style.left = startX + 'vw';

    // n·ªôi dung: d√πng ·∫£nh n·∫øu c√≥, n·∫øu kh√¥ng d√πng SVG inline
    if(CONFIG.useImage && CONFIG.imageURL){
      el.innerHTML = `<img src="${CONFIG.imageURL}" alt="" style="width:100%;height:100%;display:block;"/>`;
    } else {
      el.innerHTML = PETAL_SVG;
    }

    // r·ªùi r·∫°c ho√° animation b·∫±ng transform + transition + requestAnimationFrame
    const duration = rand(CONFIG.fallDurationMin, CONFIG.fallDurationMax);
    const sway = rand(40, CONFIG.swayRange);
    const rotateFrom = rand(CONFIG.rotationMin, CONFIG.rotationMax);
    const rotateTo = rotateFrom + rand(90, 720);

    // Random delay nh·ªè ƒë·ªÉ kh√¥ng ƒë·ªìng b·ªô
    const delay = rand(0, 1200);

    // Thi·∫øt l·∫≠p animation b·∫±ng CSS transition (t·ªëi ∆∞u nh·∫π) ho·∫∑c keyframes
    // 1) ƒë·∫∑t tr·∫°ng th√°i b·∫Øt ƒë·∫ßu
    el.style.transform = `translateY(-10vh) rotate(${rotateFrom}deg) translateX(0px)`;
    el.style.opacity = (rand(0.75, 1)).toFixed(2);

    // Th√™m v√†o DOM
    wrap.appendChild(el);

    // Force reflow ƒë·ªÉ transition c√≥ hi·ªáu l·ª±c
    void el.offsetWidth;

    // T√≠nh to·∫° ƒë·ªô k·∫øt th√∫c
    const endY = window.innerHeight + 100; // px
    const swayX = (Math.random() < 0.5 ? -1 : 1) * sway;
    const durationSec = duration / 1000;

    // T·∫°o keyframes b·∫±ng animate() Web Animations API (nh·∫π, c√≥ control)
    if(el.animate){
      const keyframes = [
        { transform: `translateY(-10vh) rotate(${rotateFrom}deg) translateX(0px)`, opacity: el.style.opacity },
        { transform: `translateY(${endY}px) rotate(${rotateTo}deg) translateX(${swayX}px)`, opacity: 0.9 }
      ];
      const anim = el.animate(keyframes, {
        duration: duration,
        delay: delay,
        easing: 'linear'
      });
      anim.onfinish = () => el.remove();
    } else {
      // Fallback: transition
      el.style.transition = `transform ${durationSec}s linear ${delay/1000}s, opacity ${durationSec}s linear ${delay/1000}s`;
      el.style.transform = `translateY(${endY}px) rotate(${rotateTo}deg) translateX(${swayX}px)`;
      el.style.opacity = '0.9';
      setTimeout(()=> el.remove(), duration + delay + 200);
    }
  }

  function startSpawning(){
    if(intervalId) return;
    // t·∫°o ngay m·ªôt v√†i chi·∫øc ƒë·ªÉ ƒë·∫ßy s·ªõm
    for(let i=0;i<Math.min(CONFIG.petalCount,6);i++) createPetal();
    intervalId = setInterval(()=>{
      if(!running) return;
      // n·∫øu qu√° nhi·ªÅu ph·∫ßn t·ª≠, t·∫°m d·ª´ng t·∫°o
      if(wrap.children.length > CONFIG.petalCount * 1.5) return;
      createPetal();
    }, CONFIG.spawnInterval);
  }

  function stopSpawning(){
    clearInterval(intervalId); intervalId = null;
  }

  // Toggle control
  const toggleBtn = document.getElementById('toggleBtn');
  toggleBtn.addEventListener('click', ()=>{
    running = !running;
    toggleBtn.textContent = running ? 'T·∫Øt hoa anh ƒë√†o' : 'B·∫≠t hoa anh ƒë√†o';
    if(running) startSpawning();
  });

  // Start on load
  startSpawning();

  // Clean up on page hide to avoid memory leak
  window.addEventListener('pagehide', ()=>{
    stopSpawning();
  });

  // H·ªó tr·ª£ resume when tab becomes visible
  document.addEventListener('visibilitychange', ()=>{
    if(document.hidden) stopSpawning(); else startSpawning();
  });

  // Expose a small API (optional) ƒë·ªÉ dev c√≥ th·ªÉ ƒëi·ªÅu khi·ªÉn t·ª´ console
  window.SAKURA = {
    start: ()=>{ running = true; startSpawning(); },
    stop: ()=>{ running = false; stopSpawning(); },
    setCount: (n)=>{ CONFIG.petalCount = Number(n) },
    config: CONFIG
  };
  </script>
</body>
</html>
